"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}angular.module("varroa.upload",["ngFileUpload"]),angular.module("varroa.upload").controller("UploadsCtrl",["$http",function(e){var t=this;t.uploads=[],e.get("/api/uploads").success(function(e){t.uploads=e,t.uploads.length&&t.select(0)});var a=function(){t.index>t.uploads.length-1&&(t.index=0),t.index<0&&(t.index=t.uploads.length-1),t.selected=t.uploads[t.index]};t.next=function(){t.index++,a()},t.prev=function(){t.index--,a()},t.select=function(e){t.index=e,a()}}]),angular.module("varroa.upload").controller("UploadCtrl",["_","$upload","$timeout","$q",function(e,t,a,l){var s=this;s.files=[],s.uploads=[];var o=function(e,a){var o=l.defer();return s.uploads[a]={i:a,progress:0},t.upload({url:"/api/uploads",file:e,fields:{name:s.name}}).progress(function(e){var t=e.loaded,l=e.total;s.uploads[a]&&(s.uploads[a].progress=parseInt(100*t/l))}).success(function(){return o.resolve()}).error(function(e){o.reject(e)}),o.promise};s.submit=function(){s.error=s.success=void 0,s.inProgress=!0;var t=e.map(s.files,o);l.all(t).then(function(){s.success=!0,s.inProgress=!1,s.files=[],a(function(){return s.uploads=[]},3e3)})["catch"](function(e){s.error=e,s.uploads=[],s.inProgress=!1})}}]),angular.module("varroa.tile",[]).config(["$stateProvider",function(e){e.state("tilevote",{parent:"varroa",template:"<tile-vote></tile-vote>",url:"/categorise"})}]),angular.module("varroa.tile").directive("tileVote",["$http",function(e){return{restrict:"E",link:function(t){function a(){t.counting||(t.counting=!0,e.get("/api/tiles/count").success(function(e){t.counting=!1,t.counts=e}))}function l(l,o){o.ponder_time=Date.now()-s,_.remove(t.tiles,"_id",l),e.post("/api/tiles/"+l+"/vote",o).success(function(){t.tiles.length<10&&t.fetchTiles(),t.expert||a()})}var s=Date.now();t.expert=!1,t.tiles=[],t.fetchTiles=function(){t.fetching||(t.fetching=!0,e.get("/api/tiles/random").success(function(e){var a;t.fetching=!1,(a=t.tiles).push.apply(a,_toConsumableArray(e)),t.tiles=_.uniq(t.tiles,"_id"),t.tiles.length<10&&t.fetchTiles()}))},t.fetchTiles(),a(),t.showNext=function(){t.tiles.shift(),t.tiles.length<10&&t.fetchTiles()},t.goExpert=function(){t.expert=!0},t.leaveExpert=function(){t.expert=!1},t.downVote=function(e){l(e,{bee:!1})},t.upVote=function(e){l(e,{bee:!0})},t.parasite=function(e){l(e,{parasite:!0})}},templateUrl:"/varroa/tile/tile-vote.html"}}]),angular.module("varroa",["ui.router","infinite-scroll","angularMoment","varroa.upload","varroa.tile","angulartics.google.analytics"]).constant("_",window._).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("varroa",{views:{"@":{templateUrl:"/varroa/layout/layout.html"},"header@":{template:"<varroa-header></varroa-header>"}}}).state("home",{parent:"varroa",templateUrl:"/varroa/home/home.html",url:"/"}),t.otherwise("/")}]),angular.module("varroa").directive("varroaHeader",function(){return{restrict:"E",templateUrl:"/varroa/layout/header.html"}}),function(e){try{e=angular.module("varroa")}catch(t){e=angular.module("varroa",[])}e.run(["$templateCache",function(e){e.put("/varroa/home/home.html",'<div class="jumbotron text-center"><h1>Varroa Vision</h1><div class="text-center"><img src="https://upload.wikimedia.org/wikipedia/commons/a/a6/Varroa_Mite.jpg"></div><dl><dt>Varroa destructor</dt><dd>a microscopic mite which is a debilitating parasite of the honeybee, causing loss of honey production.</dd></dl><h3>What We Hope</h3><p>That we can develop computer vision to detect the presence of varroa mite.</p><h3>What We Need</h3><p>Your eyes! Help categorise the images &mdash; all you need to do is to be able to spot the difference between a picture that has a bee in it, and one that doesn\'t. Simple, right?</p><button class="btn btn-lg btn-primary" ui-sref="tilevote">Get Started</button></div>')}])}(),function(e){try{e=angular.module("varroa")}catch(t){e=angular.module("varroa",[])}e.run(["$templateCache",function(e){e.put("/varroa/layout/header.html",'<div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a ui-sref="home" class="navbar-brand">Varroa Vision</a></div><nav class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a ui-sref="tilevote">Categorise</a></li></ul></nav></div>')}])}(),function(e){try{e=angular.module("varroa")}catch(t){e=angular.module("varroa",[])}e.run(["$templateCache",function(e){e.put("/varroa/layout/layout.html",'<header class="navbar navbar-fixed-top" role="banner" ui-view="header@"></header><section class="container"><ui-view></ui-view></section>')}])}(),function(e){try{e=angular.module("varroa")}catch(t){e=angular.module("varroa",[])}e.run(["$templateCache",function(e){e.put("/varroa/upload/upload.html",'<section class="container-fluid"><div class="row"><div class="col-xs-12"><h3>Upload Files</h3><p>Upload pictures of bee frames here.</p><p>If they have mites that\'s great, but we need pictures of "normal" bees too! Ideally they\'ll be pictures from a phone.</p><form name="form"><div class="form-group"><input class="form-control input-lg" ng-model="uploadCtrl.name" placeholder="Your name â€” optional!"></div><div class="form-group"><div ng-file-select ng-file-drop ng-model="uploadCtrl.files" drag-over-class="{accept:\'ok\', reject:\'err\', delay:100}" class="droppable" ng-multiple="true" allow-dir="false" ng-accept="\'image/*\'" drop-available="dropAvailable" style="overflow: hidden"><div ng-hide="dropAvailable" class="ide">File Drop not available</div><div ng-show="dropAvailable && !uploadCtrl.files.length" class="">drop images here</div><div ng-repeat="file in uploadCtrl.files"><i class="fa fa-picture-o text-success"></i> {{file.name}}</div></div></div><div class="form-group"><button class="btn btn-lg btn-primary btn-block" ng-disabled="!uploadCtrl.files.length" ng-click="uploadCtrl.submit()" ng-hide="uploadCtrl.inProgress"><i class="fa fa-upload"></i> Upload</button></div><div class="form-group"><div class="progress" ng-show="uploadCtrl.uploads.length" ng-repeat="upload in uploadCtrl.uploads"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="{{upload.progress}}" aria-valuemin="0" aria-valuemax="100" style="width: {{upload.progress}}%"><span class="sr-only">{{upload.progress}}% complete</span></div></div><div class="alert alert-success" ng-show="uploadCtrl.success"><i class="fa fa-check"></i> Upload complete! Thanks!</div><div class="alert alert-danger" ng-show="uploadCtrl.error"><i class="fa fa-close"></i> Upload failed. Please try again later. <code>{{uploadCtrl.error}}</code></div></div></form></div></div></section>')}])}(),function(e){try{e=angular.module("varroa")}catch(t){e=angular.module("varroa",[])}e.run(["$templateCache",function(e){e.put("/varroa/upload/uploads.html",'<section class="container-fluid"><div class="jumbotron" ng-if="uploadsCtrl.selected"><div class="col-md-8"><img class="uploads-img" src="{{uploadsCtrl.selected.url}}"></div><div class="col-md-4"><table class="table table-striped table-condensed"><tbody><tr><td>{{uploadsCtrl.index + 1}} of {{uploadsCtrl.uploads.length}} images</td></tr><tr><td>{{uploadsCtrl.selected.name}}</td></tr><tr><td>{{uploadsCtrl.selected.size}}</td></tr><tr><td><span am-time-ago="uploadsCtrl.selected.ts"></span></td></tr><tr><td><div class="btn-group"><button class="btn btn-default" ng-click="uploadsCtrl.prev()"><i class="fa fa-angle-double-left"></i></button> <button class="btn btn-default" ng-click="uploadsCtrl.next()"><i class="fa fa-angle-double-right"></i></button></div></td></tr></tbody></table></div></div><div class="row"><table class="table table-striped table-hover"><thead><tr><th>Image</th><th>Size</th><th>By</th><th>Uploaded</th></tr></thead><tbody><tr ng-repeat="upload in uploadsCtrl.uploads" ng-click="uploadsCtrl.select($index)" ng-class="{ info: $index == uploadsCtrl.index }"><td>{{upload.id}}</td><td>{{upload.size}}</td><td>{{upload.name}}</td><td><span am-time-ago="upload.ts"></span></td></tr></tbody></table></div></section>')}])}(),function(e){try{e=angular.module("varroa")}catch(t){e=angular.module("varroa",[])}e.run(["$templateCache",function(e){e.put("/varroa/tile/tile-vote.html",'<div class="text-center"><div class="text-center" ng-if="expert"><button class="btn btn-warning active" ng-click="leaveExpert()" analytics-on analytics-category="Tile" analytics-event="leaveexpert"><i class="fa fa-toggle-on"></i> Expert Mode</button><label>Slow the torrent!</label></div><div class="tile-list" infinite-scroll="fetchTiles()" infinite-scroll-disabled="fetching || !expert"><div class="tile form-group" ng-repeat="tile in tiles track by tile._id" ng-show="$first || expert"><div class="grid-row"><div class="stretch text-right top"><button class="btn btn-default btn-lg" ng-click="downVote(tile._id)" analytics-on analytics-category="Tile" analytics-event="downvote"><i class="fa fa-thumbs-down"></i></button><label>I don\'t see a bee</label></div><div class="top"><img ng-src="{{tile.url}}"></div><div class="stretch text-left top"><button class="btn btn-success btn-lg" ng-click="upVote(tile._id)" analytics-on analytics-category="Tile" analytics-event="upvote"><i class="fa fa-thumbs-up"></i></button><label>I see a bee</label></div></div><div class="grid-row" ng-if="!expert"><div class="stretch"><button class="btn btn-link" ng-click="showNext()" analytics-on analytics-category="Tile" analytics-event="newpic">Give me a different picture</button></div></div></div></div><div ng-if="fetching"><div class="placeholder"><i class="fa fa-2x fa-spinner fa-spin"></i><label>Fetching more...</label></div></div><div class="text-center" ng-if="!counts"><i class="fa fa-spinner fa-spin"></i></div><div class="grid-row form-group" ng-if="!expert && counts"><div class="text-success stretch text-right"><span class="badge">{{counts.bees}}</span> bees</div><div class="text-muted"><span class="badge">{{counts.uncategoriseds}}</span> uncategorised</div><div class="text-muted stretch text-left"><span class="badge">{{counts.unbees}}</span> not bees</div></div><div ng-if="!expert"><button class="btn btn-warning" ng-click="goExpert()" analytics-on analytics-category="Tile" analytics-event="goexpert"><i class="fa fa-toggle-off"></i> Expert Mode</button><label>I am ready for a torrent of images</label></div></div><div class="explanation" ng-if="!expert"><h3 class="text-center">What Do I Need To Do Here?</h3><p class="lead text-center">Click on the <i class="fa fa-thumbs-up text-success"></i> if the image has a bee in it; the <i class="fa fa-thumbs-down"></i> if it doesn\'t. Some of the images will be blurry and hard to make out just what they have in them. Don\'t worry &mdash; if you can\'t tell what it is, it\'s not a bee.</p></div>')}])}();