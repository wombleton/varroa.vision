"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var a=0,t=Array(e.length);a<e.length;a++)t[a]=e[a];return t}return Array.from(e)}angular.module("varroa.upload",["ngFileUpload"]),angular.module("varroa.upload").controller("UploadsCtrl",["$http",function(e){var a=this;a.uploads=[],e.get("/api/uploads").success(function(e){a.uploads=e,a.uploads.length&&a.select(0)});var t=function(){a.index>a.uploads.length-1&&(a.index=0),a.index<0&&(a.index=a.uploads.length-1),a.selected=a.uploads[a.index]};a.next=function(){a.index++,t()},a.prev=function(){a.index--,t()},a.select=function(e){a.index=e,t()}}]),angular.module("varroa.upload").controller("UploadCtrl",["_","$upload","$timeout","$q",function(e,a,t,l){var r=this;r.files=[],r.uploads=[];var o=function(e,t){var o=l.defer();return r.uploads[t]={i:t,progress:0},a.upload({url:"/api/uploads",file:e,fields:{name:r.name}}).progress(function(e){var a=e.loaded,l=e.total;r.uploads[t]&&(r.uploads[t].progress=parseInt(100*a/l))}).success(function(){return o.resolve()}).error(function(e){o.reject(e)}),o.promise};r.submit=function(){r.error=r.success=void 0,r.inProgress=!0;var a=e.map(r.files,o);l.all(a).then(function(){r.success=!0,r.inProgress=!1,r.files=[],t(function(){return r.uploads=[]},3e3)})["catch"](function(e){r.error=e,r.uploads=[],r.inProgress=!1})}}]),angular.module("varroa.tile",[]).config(["$stateProvider",function(e){e.state("tilevote",{parent:"varroa",template:"<tile-vote></tile-vote>",url:"/categorise"})}]),angular.module("varroa.tile").directive("tileVote",["$http",function(e){return{restrict:"E",link:function(a){function t(){e.get("/api/tiles/count").success(function(e){a.counts=e})}function l(l,o){o.ponder_time=Date.now()-r,_.remove(a.tiles,"_id",l),e.post("/api/tiles/"+l+"/vote",o).success(function(){a.tiles.length<10&&a.fetchTiles(),t()})}var r=Date.now();a.expert=!1,a.tiles=[],a.fetchTiles=function(){e.get("/api/tiles/random").success(function(e){var t;(t=a.tiles).push.apply(t,_toConsumableArray(e)),a.tiles=_.uniq(a.tiles,"_id"),a.tiles.length<10&&a.fetchTiles()})},a.fetchTiles(),t(),a.goExpert=function(){a.expert=!0},a.downVote=function(e){l(e,{bee:!1})},a.upVote=function(e){l(e,{bee:!0})},a.parasite=function(e){l(e,{parasite:!0})}},templateUrl:"/varroa/tile/tile-vote.html"}}]),angular.module("varroa",["ui.router","infinite-scroll","angularMoment","varroa.upload","varroa.tile","angulartics.google.analytics"]).constant("_",window._).config(["$stateProvider","$urlRouterProvider",function(e,a){e.state("varroa",{views:{"@":{templateUrl:"/varroa/layout/layout.html"},"header@":{template:"<varroa-header></varroa-header>"}}}).state("home",{parent:"varroa",templateUrl:"/varroa/home/home.html",url:"/"}).state("uploads",{parent:"varroa",controller:"UploadsCtrl as uploadsCtrl",templateUrl:"/varroa/upload/uploads.html",url:"/uploads"}).state("upload",{parent:"varroa",controller:"UploadCtrl as uploadCtrl",templateUrl:"/varroa/upload/upload.html",url:"/add"}),a.otherwise("/")}]),angular.module("varroa").directive("varroaHeader",function(){return{restrict:"E",templateUrl:"/varroa/layout/header.html"}}),function(e){try{e=angular.module("varroa")}catch(a){e=angular.module("varroa",[])}e.run(["$templateCache",function(e){e.put("/varroa/home/home.html",'<div class="jumbotron text-center"><h1>Varroa Vision</h1><div class="text-center"><img src="https://upload.wikimedia.org/wikipedia/commons/a/a6/Varroa_Mite.jpg"></div><dl><dt>Varroa destructor</dt><dd>a microscopic mite which is a debilitating parasite of the honeybee, causing loss of honey production.</dd></dl><h3>What We Hope</h3><p>That we can develop computer vision to detect the presence of varroa mite.</p><h3>What We Need</h3><p>Your eyes! Help categorise the images &mdash; all you need to do is to be able to spot the difference between a picture that has a bee in it, and one that doesn\'t. Simple, right?</p><button class="btn btn-lg btn-primary" ui-sref="tilevote">Get Started</button></div>')}])}(),function(e){try{e=angular.module("varroa")}catch(a){e=angular.module("varroa",[])}e.run(["$templateCache",function(e){e.put("/varroa/layout/header.html",'<div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a ui-sref="home" class="navbar-brand">Varroa Vision</a></div><nav class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a ui-sref="tilevote">Categorise</a></li></ul></nav></div>')}])}(),function(e){try{e=angular.module("varroa")}catch(a){e=angular.module("varroa",[])}e.run(["$templateCache",function(e){e.put("/varroa/layout/layout.html",'<header class="navbar navbar-fixed-top" role="banner" ui-view="header@"></header><section class="container"><ui-view></ui-view></section>')}])}(),function(e){try{e=angular.module("varroa")}catch(a){e=angular.module("varroa",[])}e.run(["$templateCache",function(e){e.put("/varroa/tile/tile-vote.html",'<div class="text-center"><div ng-if="tiles.length === 0"><div class="placeholder"><i class="fa fa-2x fa-spinner fa-spin"></i><label>Fetching more...</label></div></div><div class="tile-list" infinite-scroll="fetchTiles()" infinite-scroll-distance="3" infinite-scroll-disabled="!expert"><div class="tile form-group" ng-repeat="tile in tiles track by tile._id" ng-show="$first || expert"><div class="grid-row"><div class="stretch text-right top"><button class="btn btn-default btn-lg" ng-click="downVote(tile._id)"><i class="fa fa-thumbs-down"></i></button><label>I don\'t see a bee</label></div><div class="top"><img ng-src="{{tile.url}}"></div><div class="stretch text-left top"><button class="btn btn-success btn-lg" ng-click="upVote(tile._id)"><i class="fa fa-thumbs-up"></i></button><label>I see a bee</label></div></div><div class="grid-row" ng-if="!expert"><div class="stretch"><button class="btn btn-link" ng-click="showNext()">Give me a different picture</button></div></div></div></div><div class="grid-row form-group" ng-if="!expert"><div class="text-success stretch text-right"><span class="badge">{{counts.bees}}</span> bees</div><div class="text-muted"><span class="badge">{{counts.uncategoriseds}}</span> uncategorised</div><div class="text-muted stretch text-left"><span class="badge">{{counts.unbees}}</span> not bees</div></div><div ng-if="!expert"><button class="btn btn-warning" ng-click="goExpert()"><i class="fa fa-rocket"></i> Expert Mode</button><label>I am ready for a torrent of images</label></div></div><div class="explanation" ng-if="!expert"><h3 class="text-center">What Do I Need To Do Here?</h3><p class="lead text-center">Click on the <i class="fa fa-thumbs-up text-success"></i> if the image has a bee in it; the <i class="fa fa-thumbs-down"></i> if it doesn\'t. Some of the images will be blurry and hard to make out just what they have in them. Don\'t worry &mdash; if you can\'t tell what it is, it\'s not a bee.</p></div>')}])}(),function(e){try{e=angular.module("varroa")}catch(a){e=angular.module("varroa",[])}e.run(["$templateCache",function(e){e.put("/varroa/upload/upload.html",'<section class="container-fluid"><div class="row"><div class="col-xs-12"><h3>Upload Files</h3><p>Upload pictures of bee frames here.</p><p>If they have mites that\'s great, but we need pictures of "normal" bees too! Ideally they\'ll be pictures from a phone.</p><form name="form"><div class="form-group"><input class="form-control input-lg" ng-model="uploadCtrl.name" placeholder="Your name â€” optional!"></div><div class="form-group"><div ng-file-select ng-file-drop ng-model="uploadCtrl.files" drag-over-class="{accept:\'ok\', reject:\'err\', delay:100}" class="droppable" ng-multiple="true" allow-dir="false" ng-accept="\'image/*\'" drop-available="dropAvailable" style="overflow: hidden"><div ng-hide="dropAvailable" class="ide">File Drop not available</div><div ng-show="dropAvailable && !uploadCtrl.files.length" class="">drop images here</div><div ng-repeat="file in uploadCtrl.files"><i class="fa fa-picture-o text-success"></i> {{file.name}}</div></div></div><div class="form-group"><button class="btn btn-lg btn-primary btn-block" ng-disabled="!uploadCtrl.files.length" ng-click="uploadCtrl.submit()" ng-hide="uploadCtrl.inProgress"><i class="fa fa-upload"></i> Upload</button></div><div class="form-group"><div class="progress" ng-show="uploadCtrl.uploads.length" ng-repeat="upload in uploadCtrl.uploads"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="{{upload.progress}}" aria-valuemin="0" aria-valuemax="100" style="width: {{upload.progress}}%"><span class="sr-only">{{upload.progress}}% complete</span></div></div><div class="alert alert-success" ng-show="uploadCtrl.success"><i class="fa fa-check"></i> Upload complete! Thanks!</div><div class="alert alert-danger" ng-show="uploadCtrl.error"><i class="fa fa-close"></i> Upload failed. Please try again later. <code>{{uploadCtrl.error}}</code></div></div></form></div></div></section>')}])}(),function(e){try{e=angular.module("varroa")}catch(a){e=angular.module("varroa",[])}e.run(["$templateCache",function(e){e.put("/varroa/upload/uploads.html",'<section class="container-fluid"><div class="jumbotron" ng-if="uploadsCtrl.selected"><div class="col-md-8"><img class="uploads-img" src="{{uploadsCtrl.selected.url}}"></div><div class="col-md-4"><table class="table table-striped table-condensed"><tbody><tr><td>{{uploadsCtrl.index + 1}} of {{uploadsCtrl.uploads.length}} images</td></tr><tr><td>{{uploadsCtrl.selected.name}}</td></tr><tr><td>{{uploadsCtrl.selected.size}}</td></tr><tr><td><span am-time-ago="uploadsCtrl.selected.ts"></span></td></tr><tr><td><div class="btn-group"><button class="btn btn-default" ng-click="uploadsCtrl.prev()"><i class="fa fa-angle-double-left"></i></button> <button class="btn btn-default" ng-click="uploadsCtrl.next()"><i class="fa fa-angle-double-right"></i></button></div></td></tr></tbody></table></div></div><div class="row"><table class="table table-striped table-hover"><thead><tr><th>Image</th><th>Size</th><th>By</th><th>Uploaded</th></tr></thead><tbody><tr ng-repeat="upload in uploadsCtrl.uploads" ng-click="uploadsCtrl.select($index)" ng-class="{ info: $index == uploadsCtrl.index }"><td>{{upload.id}}</td><td>{{upload.size}}</td><td>{{upload.name}}</td><td><span am-time-ago="upload.ts"></span></td></tr></tbody></table></div></section>')}])}();