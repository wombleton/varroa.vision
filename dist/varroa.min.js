"use strict";angular.module("varroa.upload",["ngFileUpload"]),angular.module("varroa.upload").controller("UploadsCtrl",["$http",function(a){var t=this;t.uploads=[],a.get("/api/uploads").success(function(a){t.uploads=a,t.uploads.length&&t.select(0)});var e=function(){t.index>t.uploads.length-1&&(t.index=0),t.index<0&&(t.index=t.uploads.length-1),t.selected=t.uploads[t.index]};t.next=function(){t.index++,e()},t.prev=function(){t.index--,e()},t.select=function(a){t.index=a,e()}}]),angular.module("varroa.upload").controller("UploadCtrl",["_","$upload","$timeout","$q",function(a,t,e,l){var o=this;o.files=[],o.uploads=[];var r=function(a,e){var r=l.defer();return o.uploads[e]={i:e,progress:0},t.upload({url:"/api/uploads",file:a,fields:{name:o.name}}).progress(function(a){var t=a.loaded,l=a.total;o.uploads[e]&&(o.uploads[e].progress=parseInt(100*t/l))}).success(function(){return r.resolve()}).error(function(a){r.reject(a)}),r.promise};o.submit=function(){o.error=o.success=void 0,o.inProgress=!0;var t=a.map(o.files,r);l.all(t).then(function(){o.success=!0,o.inProgress=!1,o.files=[],e(function(){return o.uploads=[]},3e3)})["catch"](function(a){o.error=a,o.uploads=[],o.inProgress=!1})}}]),angular.module("varroa.tile",[]).config(["$stateProvider",function(a){a.state("tilevote",{parent:"varroa",template:"<tile-vote></tile-vote>",url:"/categorise"})}]),angular.module("varroa.tile").directive("tileVote",["$http",function(a){return{restrict:"E",link:function(t){function e(){a.get("/api/tiles/random").success(function(a){t.tile?t.next=a:(t.tile=a,e())})}function l(){a.get("/api/tiles/count").success(function(a){t.counts=a})}function o(e,o){o.ponder_time=Date.now()-r,a.post("/api/tiles/"+e+"/vote",o).success(function(){l(),t.showNext()})}var r=Date.now();e(),l(),t.showNext=function(){t.tile=t.next,r=Date.now(),t.next=void 0,e()},t.downVote=function(a){o(a,{bee:!1})},t.upVote=function(a){o(a,{bee:!0})},t.parasite=function(a){o(a,{parasite:!0})}},templateUrl:"/varroa/tile/tile-vote.html"}}]),angular.module("varroa",["ui.router","angularMoment","varroa.upload","varroa.tile","angulartics.google.analytics"]).constant("_",window._).config(["$stateProvider","$urlRouterProvider",function(a,t){a.state("varroa",{views:{"@":{templateUrl:"/varroa/layout/layout.html"},"header@":{template:"<varroa-header></varroa-header>"}}}).state("home",{parent:"varroa",templateUrl:"/varroa/home/home.html",url:"/"}).state("uploads",{parent:"varroa",controller:"UploadsCtrl as uploadsCtrl",templateUrl:"/varroa/upload/uploads.html",url:"/uploads"}).state("upload",{parent:"varroa",controller:"UploadCtrl as uploadCtrl",templateUrl:"/varroa/upload/upload.html",url:"/add"}),t.otherwise("/")}]),angular.module("varroa").directive("varroaHeader",function(){return{restrict:"E",templateUrl:"/varroa/layout/header.html"}}),function(a){try{a=angular.module("varroa")}catch(t){a=angular.module("varroa",[])}a.run(["$templateCache",function(a){a.put("/varroa/home/home.html",'<div class="jumbotron text-center"><h1>Varroa Vision</h1><div class="text-center"><img src="https://upload.wikimedia.org/wikipedia/commons/a/a6/Varroa_Mite.jpg"></div><dl><dt>Varroa destructor</dt><dd>a microscopic mite which is a debilitating parasite of the honeybee, causing loss of honey production.</dd></dl><h3>What We Hope</h3><p>That we can develop computer vision to detect the presence of varroa mite.</p><h3>What We Need</h3><p>Your eyes! Help categorise the images &mdash; all you need to do is to be able to spot the difference between a picture that has a bee in it, and one that doesn\'t. Simple, right?</p><button class="btn btn-lg btn-primary" ui-sref="tilevote">Get Started</button></div>')}])}(),function(a){try{a=angular.module("varroa")}catch(t){a=angular.module("varroa",[])}a.run(["$templateCache",function(a){a.put("/varroa/layout/header.html",'<div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a ui-sref="home" class="navbar-brand">Varroa Vision</a></div><nav class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a ui-sref="tilevote">Categorise</a></li></ul></nav></div>')}])}(),function(a){try{a=angular.module("varroa")}catch(t){a=angular.module("varroa",[])}a.run(["$templateCache",function(a){a.put("/varroa/layout/layout.html",'<header class="navbar navbar-fixed-top" role="banner" ui-view="header@"></header><section class="container"><ui-view></ui-view></section>')}])}(),function(a){try{a=angular.module("varroa")}catch(t){a=angular.module("varroa",[])}a.run(["$templateCache",function(a){a.put("/varroa/tile/tile-vote.html",'<div ng-if="tile" class="text-center"><table><tbody><tr><td class="text-right"><button class="btn btn-default btn-lg" ng-click="downVote(tile._id)"><i class="fa fa-thumbs-down"></i></button><label>I don\'t see a bee</label></td><td><img ng-src="{{tile.url}}" width="128" height="128"></td><td class="text-left"><button class="btn btn-success btn-lg" ng-click="upVote(tile._id)"><i class="fa fa-thumbs-up"></i></button><label>I see a bee</label></td></tr><tr><td colspan="3"><button class="btn btn-danger" ng-click="parasite(tile._id)"><i class="fa fa-bug"></i> Varroa!</button><label>I see a varroa mite</label></td></tr><tr><td colspan="3"><button class="btn btn-link" ng-click="showNext()">Give me a different picture</button></td></tr><tr><td class="text-success"><span class="badge">{{counts.bees}}</span> bees</td><td class="text-muted"><span class="badge">{{counts.unbees}}</span> not bees</td><td class="text-danger"><span class="badge">{{counts.varroas}}</span> mites</td></tr><tr><td></td><td class="text-muted"><span class="badge">{{counts.uncategoriseds}}</span> uncategorised</td></tr></tbody></table></div><div ng-if="!tile"><div class="row form-group"><div class="col-xs-12 text-center"><i class="fa fa-3x fa-spinner fa-spin"></i></div></div></div><h3 class="text-center">What Do I Need To Do Here?</h3><p class="lead text-center">Click on the <i class="fa fa-thumbs-up text-success"></i> if the image has a bee in it; the <i class="fa fa-thumbs-down"></i> if it doesn\'t. Some of the images will be blurry and hard to make out just what they have in them. Don\'t worry &mdash; if you can\'t tell what it is, it\'s not a bee.</p><p class="lead text-center"><b>Bonus points!</b> If you spot a varroa mite, click the <i class="fa fa-bug text-danger"></i> button! Varroa mites look like this, but as you can see they\'re pretty small:</p><p class="text-center"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2e/Varroa_destructor_on_drone_66a.jpg/128px-Varroa_destructor_on_drone_66a.jpg"></p>')}])}(),function(a){try{a=angular.module("varroa")}catch(t){a=angular.module("varroa",[])}a.run(["$templateCache",function(a){a.put("/varroa/upload/upload.html",'<section class="container-fluid"><div class="row"><div class="col-xs-12"><h3>Upload Files</h3><p>Upload pictures of bee frames here.</p><p>If they have mites that\'s great, but we need pictures of "normal" bees too! Ideally they\'ll be pictures from a phone.</p><form name="form"><div class="form-group"><input class="form-control input-lg" ng-model="uploadCtrl.name" placeholder="Your name â€” optional!"></div><div class="form-group"><div ng-file-select ng-file-drop ng-model="uploadCtrl.files" drag-over-class="{accept:\'ok\', reject:\'err\', delay:100}" class="droppable" ng-multiple="true" allow-dir="false" ng-accept="\'image/*\'" drop-available="dropAvailable" style="overflow: hidden"><div ng-hide="dropAvailable" class="ide">File Drop not available</div><div ng-show="dropAvailable && !uploadCtrl.files.length" class="">drop images here</div><div ng-repeat="file in uploadCtrl.files"><i class="fa fa-picture-o text-success"></i> {{file.name}}</div></div></div><div class="form-group"><button class="btn btn-lg btn-primary btn-block" ng-disabled="!uploadCtrl.files.length" ng-click="uploadCtrl.submit()" ng-hide="uploadCtrl.inProgress"><i class="fa fa-upload"></i> Upload</button></div><div class="form-group"><div class="progress" ng-show="uploadCtrl.uploads.length" ng-repeat="upload in uploadCtrl.uploads"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="{{upload.progress}}" aria-valuemin="0" aria-valuemax="100" style="width: {{upload.progress}}%"><span class="sr-only">{{upload.progress}}% complete</span></div></div><div class="alert alert-success" ng-show="uploadCtrl.success"><i class="fa fa-check"></i> Upload complete! Thanks!</div><div class="alert alert-danger" ng-show="uploadCtrl.error"><i class="fa fa-close"></i> Upload failed. Please try again later. <code>{{uploadCtrl.error}}</code></div></div></form></div></div></section>')}])}(),function(a){try{a=angular.module("varroa")}catch(t){a=angular.module("varroa",[])}a.run(["$templateCache",function(a){a.put("/varroa/upload/uploads.html",'<section class="container-fluid"><div class="jumbotron" ng-if="uploadsCtrl.selected"><div class="col-md-8"><img class="uploads-img" src="{{uploadsCtrl.selected.url}}"></div><div class="col-md-4"><table class="table table-striped table-condensed"><tbody><tr><td>{{uploadsCtrl.index + 1}} of {{uploadsCtrl.uploads.length}} images</td></tr><tr><td>{{uploadsCtrl.selected.name}}</td></tr><tr><td>{{uploadsCtrl.selected.size}}</td></tr><tr><td><span am-time-ago="uploadsCtrl.selected.ts"></span></td></tr><tr><td><div class="btn-group"><button class="btn btn-default" ng-click="uploadsCtrl.prev()"><i class="fa fa-angle-double-left"></i></button> <button class="btn btn-default" ng-click="uploadsCtrl.next()"><i class="fa fa-angle-double-right"></i></button></div></td></tr></tbody></table></div></div><div class="row"><table class="table table-striped table-hover"><thead><tr><th>Image</th><th>Size</th><th>By</th><th>Uploaded</th></tr></thead><tbody><tr ng-repeat="upload in uploadsCtrl.uploads" ng-click="uploadsCtrl.select($index)" ng-class="{ info: $index == uploadsCtrl.index }"><td>{{upload.id}}</td><td>{{upload.size}}</td><td>{{upload.name}}</td><td><span am-time-ago="upload.ts"></span></td></tr></tbody></table></div></section>')}])}();